#This unit file replaces the traditional start-up script for systemd
#configurations, and is used when enabling boot-start for Splunk on
#systemd-based Linux distributions.

[Unit]
Description=Systemd service file for Splunk, generated by 'splunk enable boot-start'
After=network.target

[Service]
Type=simple
Restart=always
ExecStart={{ splunk_root_dir }}/bin/splunk _internal_launch_under_systemd --accept-license --answer-yes --no-prompt
KillMode=mixed
KillSignal=SIGINT
TimeoutStopSec=360
LimitNOFILE=65536
SuccessExitStatus=51 52
RestartPreventExitStatus=51
RestartForceExitStatus=52
User=splunk
Group=splunk
{% if splunk_chown_cgroups %}
NoNewPrivileges=yes
AmbientCapabilities=CAP_DAC_READ_SEARCH
Delegate=true
CPUWeight=20
MemoryMax=2G
{% endif %}
PermissionsStartOnly=true
{% if splunk_chown_cgroups | default(true) %}
{% if (splunk_cgroups_version | default(1)) < 2 %}
ExecStartPost=/bin/bash -c "chown -R splunk:splunk /sys/fs/cgroup/cpu/system.slice/%n"
ExecStartPost=/bin/bash -c "chown -R splunk:splunk /sys/fs/cgroup/memory/system.slice/%n"
{% else %}
ExecStartPost=/bin/bash -c "chown -R splunk:splunk /sys/fs/cgroup/system.slice/%n/cpu.*"
ExecStartPost=/bin/bash -c "chown -R splunk:splunk /sys/fs/cgroup/system.slice/%n/memory.*"
{% endif %}
{% endif %}

[Install]
WantedBy=multi-user.target
