---

#stats_ssl_ca_passphrase: "{{ vault_stats_ssl_ca_passphrase }}"

#stats_ssl_certs:
#  - name: influxdb
#    ca: stats
#    per_host: yes
#    owner: influxdb
#    group: influxdb
#    paths:
#      - cert: "{{ stats_influxdb_conf_dir }}/influxdb.crt"
#        key: "{{ stats_influxdb_conf_dir }}/influxdb.key"
#        ca_cert: "{{ stats_influxdb_conf_dir }}/ca.crt"

certbot_domains:
 - "{{ inventory_hostname }}"
 - infrastats.galaxyproject.org

nginx_default_redirect_uri: https://stats.galaxyproject.org/
nginx_servers:
  - certbot_redirects
nginx_ssl_servers:
  - stats

stats_influxdb_users: "{{ vault_stats_influxdb_users }}"

statsservers_group_packages:
  # for influxdb_user module
  - python-requests
  - python-pip

grafana_admin_user: "{{ vault_grafana_admin_user }}"
grafana_admin_pass: "{{ vault_grafana_admin_pass }}"
grafana_secret_key: "{{ vault_grafana_secret_key }}"

grafana_plugins:
  - grafana-image-renderer

stats_grafana_conf_auth_github_client_id: "{{ vault_stats_grafana_conf_auth_github_client_id }}"
stats_grafana_conf_auth_github_client_secret: "{{ vault_stats_grafana_conf_auth_github_client_secret }}"
stats_grafana_conf_auth_github_team_ids: "{{ vault_stats_grafana_conf_auth_github_team_ids }}"

stats_grafana_conf_root_url: "https://stats.galaxyproject.org/"
stats_grafana_conf_auth_github: true
stats_grafana_conf_auth_github_allowed_organizations:
  - galaxyproject

stats_conf_email_host: 'localhost:25'
stats_conf_email_from: 'stats@stats.galaxyproject.org'

stats_influxdb_http_bind_address: "127.0.0.1:8086"

stats_influxdb_auth_enabled: true
#stats_influxdb_https_enabled: true

#stats_influxdb_ssl_certificate: /etc/ssl/certs/fullchain.pem
#stats_influxdb_ssl_certificate_key: /etc/ssl/user/privkey-influxdb.pem

# separate db filtering for statsd (Galaxy timing) and system stuff using
#   https://github.com/influxdata/telegraf/issues/1778
telegraf_agent_output:
  - type: influxdb
    config:
      - urls = ["http://localhost:8086"]
      - database = "system"
      - username = "{{ stats_influxdb_users[1].user_name }}"
      - password = "{{ stats_influxdb_users[1].user_password }}"
      #- insecure_skip_verify = true

telegraf_plugins_default:
  - plugin: cpu
    config:
      - percpu = true
  - plugin: disk
  - plugin: kernel
  - plugin: processes
  - plugin: io
  - plugin: mem
  - plugin: system
  - plugin: swap
  - plugin: net
  - plugin: netstat
