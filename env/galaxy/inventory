##
## Variables
##

# TODO: now that so many features are enabled/disabled just based on group inclusion, it should be documented in the inventory exactly what each group membership enables

newtrail.galaxyproject.org ansible_user=ubuntu ansible_become=yes
artifact.galaxyproject.org ansible_user=ubuntu ansible_become=yes

duvel.galaxyproject.org ansible_user=ubuntu ansible_become=yes
#status.usegalaxy.org ansible_python_interpreter=/usr/bin/python3
orval.galaxyproject.org ansible_python_interpreter=/opt/local/bin/python
westvleteren.galaxyproject.org ansible_python_interpreter=/opt/local/bin/python
jetstream-tacc0.galaxyproject.org ansible_user=centos ansible_become=yes
jetstream-iu0.galaxyproject.org ansible_user=centos ansible_become=yes
cvmfs0-tacc0.galaxyproject.org ansible_user=root
cvmfs1-tacc0.galaxyproject.org ansible_user=centos ansible_become=yes
cvmfs1-iu0.galaxyproject.org ansible_user=centos ansible_become=yes
cvmfs0-psu0.galaxyproject.org ansible_user=root
cvmfs0-psu1.galaxyproject.org ansible_user=root
cvmfs0-psu2.galaxyproject.org ansible_user=root
cvmfs1-psu0.galaxyproject.org ansible_user=root
cvmfs-stratum0.galaxyproject.eu ansible_user=centos ansible_become=yes
testtoolshed.galaxyproject.org ansible_user=centos ansible_become=yes
#toolshed.galaxyproject.org ansible_user=centos ansible_become=yes ansible_host=129.114.17.108

# Installs Python 2.6 from SCL and automatically sets ansible_python_interpreter
# TODO: not currently working: `yum` module is incompatible with Python 3 and there is no python36-dnf module
[usepython3_el]
#stats.galaxyproject.org

[usepython3_el:vars]
ansible_python_interpreter = /opt/rh/rh-python36/root/bin/python3

[smartosglobalzones]
smart1.galaxyproject.org ansible_user=root ansible_python_interpreter=/opt/local/bin/python
smart2.galaxyproject.org ansible_user=root ansible_python_interpreter=/opt/local/bin/python
smart3.galaxyproject.org ansible_user=root ansible_python_interpreter=/opt/local/bin/python
thumper.p.galaxyproject.org ansible_user=root ansible_python_interpreter=/opt/tools/bin/python3
westvleteren.p.galaxyproject.org ansible_user=root ansible_python_interpreter=/opt/local/bin/python
orval.p.galaxyproject.org ansible_user=root ansible_python_interpreter=/opt/tools/bin/python
rochefort.p.galaxyproject.org ansible_user=root ansible_python_interpreter=/opt/tools/bin/python

# These get all the common roles. Additionally:
# - common authorized_keys for root
[baseenv]
#toolshed.galaxyproject.org
ns-training.galaxyproject.org

[baseenv:children]
galaxyenv
liteenv
jenkinsslaves
cvmfsservers

# baseenv hosts not to install telegraf on
[baseenv_no_telegraf]
cvmfs-stratum0.galaxyproject.eu

# Everything in baseenv + adds postfix, resolv.conf config
[galaxyenv]
newtrail.galaxyproject.org
artifact.galaxyproject.org
duvel.galaxyproject.org
delirium.galaxyproject.org
athena.galaxyproject.org
radegast.galaxyproject.org
orval.galaxyproject.org
westvleteren.galaxyproject.org
leeroy.galaxyproject.org
stats.galaxyproject.org
jeltz.galaxyproject.org

# For things that need access to common_sshkeys and env-specific sshkeys
[sshservers]
[sshservers:children]
baseenv
jetstreamhosts
smartosglobalzones

# For things that need access to env-specific sshprivatekeys
[sshclients]
orval.galaxyproject.org
radegast.galaxyproject.org
testtoolshed.galaxyproject.org
#toolshed.galaxyproject.org
westvleteren.galaxyproject.org

[sshclients:children]
dockerswarmmanagers
jenkinsservers
jenkinsslaves

[toolshedservers]
radegast.galaxyproject.org
testtoolshed.galaxyproject.org
#toolshed.galaxyproject.org

# For things that need access to sslkeys and the "PKI"
[sslservers]
[sslservers:children]
dockersslservers
statsservers

# These get everything in baseenv + LDAP and Kerberos+Auth, but not NFS
[liteenv]
testtoolshed.galaxyproject.org

[liteenv:children]
fullenv
infrastructure

# These get everything in liteenv + NFS
[fullenv]
radegast.galaxyproject.org
nn14.galaxyproject.org

# FIXME: why was this the case?
#[fullenv:children]
#infrastructure

##
## Host groupings
##

[infrastructure]
newtrail.galaxyproject.org
artifact.galaxyproject.org
duvel.galaxyproject.org

# - sets the hostname to the inventory_hostname
[virtual]
radegast.galaxyproject.org
testtoolshed.galaxyproject.org
#toolshed.galaxyproject.org
duvel.galaxyproject.org
stats.galaxyproject.org
jeltz.galaxyproject.org
cvmfs0-psu0.galaxyproject.org
cvmfs0-psu1.galaxyproject.org
cvmfs0-psu2.galaxyproject.org
ns-training.galaxyproject.org

[virtual:children]
ec2hosts
jetstreamhosts
cvmfsstratum1servers

[ec2hosts]
delirium.galaxyproject.org
newtrail.galaxyproject.org
artifact.galaxyproject.org
athena.galaxyproject.org

# - authorized keys for non-root admin user
# - common Openstack networks and security groups
[jetstreamhosts]
cvmfs1-iu0.galaxyproject.org
cvmfs1-tacc0.galaxyproject.org
jetstream-iu0.galaxyproject.org
jetstream-tacc0.galaxyproject.org
testtoolshed.galaxyproject.org
#toolshed.galaxyproject.org

[authkeyhosts]
[authkeyhosts:children]
jetstreamhosts

##
## Core infrastructure service groupings
##

[kerberosservers]
[kerberosservers:children]
infrastructure

[kerberosmasterservers]
duvel.galaxyproject.org

[dnsservers]
# ns-training is not here because it shouldn't get these group vars
[dnsservers:children]
infrastructure

[dnsprimaryservers]
newtrail.galaxyproject.org

[dnssecondaryservers]
artifact.galaxyproject.org
duvel.galaxyproject.org

[ldapservers]
[ldapservers:children]
infrastructure

##
## Application groupings
##

## Mail

[mailservers]
[mailservers:children]
primarymxservers
secondarymxservers

[primarymxservers]
newtrail.galaxyproject.org
artifact.galaxyproject.org

[secondarymxservers]

[listservers]

## Web

[webservers]
orval.galaxyproject.org
delirium.galaxyproject.org
newtrail.galaxyproject.org
artifact.galaxyproject.org
duvel.galaxyproject.org
athena.galaxyproject.org
jeltz.galaxyproject.org
#status.usegalaxy.org

[webservers:children]
statsservers
certbotservers

# provides:
#   - certbot setup
#   - nginx cerbot setup (could split this into a separate group if we have non-nginx certbot servers)
#   - telegraf x509_cert plugin
# users must set:
#   - nginx_servers
#   - nginx_ssl_servers
#   - certbot_domains
[certbotservers]
orval.galaxyproject.org
delirium.galaxyproject.org
duvel.galaxyproject.org
athena.galaxyproject.org
stats.galaxyproject.org
newtrail.galaxyproject.org
artifact.galaxyproject.org
# TODO: probably need to use DNS-01 for this
#status.usegalaxy.org

[certbotservers:children]
certbotdnsservers

# provides:
#   - certbot TSIG key to certbot webservers
#   - certbot DNS-01 rfc2136 provider config
# overrides WEB-01 (webroot) mode
[certbotdnsservers]

# provides:
#   - certbot TSIG key for DNS servers
#   - certbot TSIG key to certbot webservers
[certbottsigkeyservers]
[certbottsigkeyservers:children]
certbotdnsservers
dnsprimaryservers

## Kerberos

# - consume k5login_users to create ~/.k5login; without AFS and automation for the host keytab this is less relevant
#   (and cloud resources can't have reverse DNS set properly anyway)
# - install kerberos client
# - configure PAM/SSSD for kerberos auth
[kerberosauthclients]
[kerberosauthclients:children]
liteenv

## LDAP

# - install ldap client
# - configure NSS/SSSD for kerberos auth
[ldapnssclients]
[ldapnssclients:children]
liteenv

## NFS

[nfsldapclients]
[nfsldapclients:children]
fullenv

## CVMFS

# - authorized keys for CVMFS repo owners
[cvmfsservers]
[cvmfsservers:children]
cvmfsstratum0servers
cvmfsstratum1servers

[cvmfsstratum0servers]
cvmfs0-tacc0.galaxyproject.org
cvmfs0-psu0.galaxyproject.org
cvmfs0-psu1.galaxyproject.org
cvmfs0-psu2.galaxyproject.org
cvmfs-stratum0.galaxyproject.eu

[cvmfsstratum1servers]
cvmfs1-tacc0.galaxyproject.org
cvmfs1-iu0.galaxyproject.org
cvmfs1-psu0.galaxyproject.org

[cvmfsclients]
jeltz.galaxyproject.org
jetstream-iu0.galaxyproject.org

[cvmfsclients:children]
jenkinsslaves

# Docker Swarm

# there should only be one host in this group
[dockersslcamaster]
jeltz.galaxyproject.org

[dockersslservers]
jeltz.galaxyproject.org
jetstream-tacc0.galaxyproject.org
jetstream-iu0.galaxyproject.org

[dockerswarmmanagers]
jetstream-iu0.galaxyproject.org
jetstream-tacc0.galaxyproject.org
jeltz.galaxyproject.org

# Docker

[dockerservers]
[dockerservers:children]
jenkinsslaves
cvmfsstratum0servers

# Jenkins

[jenkinsservers]
leeroy.galaxyproject.org

[jenkinsslaves]
[jenkinsslaves:children]
jenkinsslaves_psu
jenkinsslaves_au
jenkinsslaves_eu

[jenkinsslaves_psu]
n1.galaxyproject.org
n2.galaxyproject.org
# n3 is leeroy
n[4:14].galaxyproject.org

[jenkinsslaves_au]
jenkins-aust-[1:4].genome.edu.au

[jenkinsslaves_au:vars]
ansible_user = ubuntu
ansible_become = yes

[jenkinsslaves_eu]
n[0:1].galaxyproject.eu

[jenkinsslaves_eu:vars]
ansible_user = ubuntu
ansible_become = yes

# Other stuff

[zfsbackupservers]
westvleteren.galaxyproject.org

[statsservers]
stats.galaxyproject.org

# for serial console setup
[x2200s]
n[0:14].galaxyproject.org
