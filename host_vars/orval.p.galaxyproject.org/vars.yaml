---

smartos_hypervisor_loader_options:
  - os_console="ttyb"
  - boot_verbose="YES"

smartos_hypervisor_nic_tags:
  - name: external
    mac: "90:5a:08:2d:b8:72"
    mtu: 9000

zfs_filesystems:
  - name: data
    compression: lz4
    atime: "off"
  - name: data/cvmfs1-psu0
    zoned: "on"

# NOTE: dataset manually attached via zonecfg:
# zonecfg -z ...
# add dataset
# set name=data/cvmfs1-psu0
# end
# verify
# commit
# exit

smartos_images:
  # rocky-9.5 20250407 linux lx-dataset 2025-04-07
  - uuid: deb80d2a-88a7-40d6-b733-f0b766c6a9ec
    state: present
    # base-64-lts 24.4.1 smartos zone-dataset 2025-01-06
  - uuid: 2f1dc911-6401-4fa4-8e9d-67ea2e39c271
    state: present

smartos_vms:
  - alias: cvmfs1-psu0
    brand: lx
    kernel_version: 5.14.0-503.38.1.el9_5.x86_64
    image_uuid: deb80d2a-88a7-40d6-b733-f0b766c6a9ec
    hostname: cvmfs1-psu0
    max_physical_memory: 8192
    quota: 32768
    resolvers: "{{ smartos_resolvers }}"
    nics:
      - nic_tag: external
        ip: "{{ lookup('dig', 'cvmfs1-psu0.galaxyproject.org') }}"
        netmask: 255.255.255.224
        gateway: 128.118.250.1
        vlan_id: 306
    customer_metadata:
      root_authorized_keys: "{{ ssh_public_keys.nate_coraor }}"
  - name: orval
    brand: joyent
    image_uuid: 2f1dc911-6401-4fa4-8e9d-67ea2e39c271
    hostname: orval
    max_physical_memory: 8192
    quota: 32768
    resolvers: "{{ smartos_resolvers }}"
    nics:
      - nic_tag: external
        ip: "{{ lookup('dig', 'orval.galaxyproject.org') }}"
        netmask: 255.255.255.224
        gateway: 128.118.250.1
        vlan_id: 306
    # data/orval is added by hand with zonecfg
    #delegate_dataset: true
    customer_metadata:
      root_authorized_keys: "{{ ssh_public_keys.nate_coraor }}"
      user-script: "/usr/sbin/mdata-get root_authorized_keys > ~root/.ssh/authorized_keys ; /usr/sbin/mdata-get root_authorized_keys > ~admin/.ssh/authorized_keys"
