---

# LiteLLM Server Configuration
litellm_port: 4000
litellm_host: "0.0.0.0"
litellm_workers: 2
litellm_debug: false
litellm_enable_auth: true

# Database Configuration
litellm_database_type: postgresql
litellm_database_host: localhost
litellm_database_port: 5432
litellm_database_name: litellm
litellm_database_user: litellm

# Model Configuration
litellm_model_api_verify_ssl: false
litellm_models:
  - model_name: "llama-4-scout"
    litellm_params:
      model: "openai/llama-4-scout"
      api_base: "https://llm.jetstream-cloud.org:1234/llama-4-scout/v1"
      api_key: "dummy-key"
      verify: "{{ litellm_model_api_verify_ssl }}"
  - model_name: "deepseek-r1"
    litellm_params:
      model: "openai/DeepSeek-R1"
      api_base: "https://llm.jetstream-cloud.org:1234/sglang/v1"
      api_key: "dummy-key"
      verify: "{{ litellm_model_api_verify_ssl }}"

# PostgreSQL Configuration
postgresql_version: "15"

# Database setup via postgresql_objects role
postgresql_objects_users:
  - name: "{{ litellm_database_user }}"
    password: "{{ litellm_database_password }}"

postgresql_objects_databases:
  - name: "{{ litellm_database_name }}"
    owner: "{{ litellm_database_user }}"

postgresql_objects_privileges:
  - database: "{{ litellm_database_name }}"
    roles: "{{ litellm_database_user }}"
    privs: ALL
    type: database

# PostgreSQL HBA Configuration
postgresql_pg_hba_conf:
  - type: local
    database: all
    user: postgres
    method: peer
  - type: local
    database: "{{ litellm_database_name }}"
    user: "{{ litellm_database_user }}"
    method: md5
  - type: host
    database: "{{ litellm_database_name }}"
    user: "{{ litellm_database_user }}"
    address: "127.0.0.1/32"
    method: md5
  - type: host
    database: "{{ litellm_database_name }}"
    user: "{{ litellm_database_user }}"
    address: "::1/128"
    method: md5

# Firewall Configuration
litellm_firewall_ports:
  - port: "{{ litellm_port }}"
    proto: tcp
    rule: allow
    comment: "LiteLLM Proxy"

# Nginx Configuration
nginx_servers:
  - server_name: "{{ inventory_hostname }}"
    listen: "443 ssl http2"
    root: "/var/www/html"
    index: "index.html"
    ssl_certificate: "/etc/letsencrypt/live/{{ inventory_hostname }}/fullchain.pem"
    ssl_certificate_key: "/etc/letsencrypt/live/{{ inventory_hostname }}/privkey.pem"
    locations:
      - name: "/"
        proxy_pass: "http://127.0.0.1:{{ litellm_port }}"
        proxy_set_header:
          - "Host $host"
          - "X-Real-IP $remote_addr"
          - "X-Forwarded-For $proxy_add_x_forwarded_for"
          - "X-Forwarded-Proto $scheme"
        proxy_buffering: "off"
  - server_name: "{{ inventory_hostname }}"
    listen: "80"
    return: "301 https://$server_name$request_uri"

# SSL/TLS Configuration
certbot_auto_renew: true
certbot_admin_email: "admin@galaxyproject.org"
certbot_domains:
  - "{{ inventory_hostname }}"
certbot_agree_tos: true

litellm_additional_firewall_ports:
  - port: "80"
    proto: tcp
    rule: allow
    comment: "HTTP for Certbot"
  - port: "443"
    proto: tcp
    rule: allow
    comment: "HTTPS for LiteLLM"
